<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="shop.tronlucky.trondapp.roundIfo">
    <resultMap id="roundInfo" type="shop.tronlucky.trondapp.model.RoundInfo">
        <id column="id" property="id"/>
        <result property="roundNumber" column="round_number"/>
        <result property="goodsName" column="goods_name"/>
        <result property="goodsImg" column="goods_img"/>
        <result property="goodsPrice" column="goods_price"/>
        <result property="seedValue" column="seed_value"/>
        <result property="seedHash" column="seed_hash"/>
        <result property="blockValue" column="block_value"/>
        <result property="luckyAddress" column="lucky_address"/>
        <result property="luckyIndex" column="lucky_index"/>
        <result property="beginTime" column="begin_time"/>
    </resultMap>

    <select id="findRoundInfoByRound" resultMap="roundInfo">
        select  id,
                round_number,
                goods_name,
                goods_img,
                goods_price,
                seed_value,
                seed_hash,
                block_value,
                lucky_address,
                lucky_index,
                date_format(begin_time,'%y-%m-%d %h:%i:%s') begin_time
        from ROUND_INFO
        <choose>
            <when test='_parameter != null'>
                where round_number = #{roundNumber}
            </when>
            <otherwise>
                order by round_number desc limit 1
            </otherwise>
        </choose>
    </select>

    <insert id="addRoundInfo" parameterType="roundInfo">
        insert into round_info(
        <trim suffixOverrides=",">
            <if test="roundNumber != null and roundNumber != ''">
                round_number,
            </if>
            <if test="goodsName != null and goodsName != ''">
                goods_name,
            </if>
            <if test="goodsImg != null and goodsImg != ''">
                goods_img,
            </if>
            <if test="goodsPrice != null and goodsPrice != ''">
                goods_price,
            </if>
            <if test="seedValue != null and seedValue != ''">
                seed_value,
            </if>
            <if test="seedHash != null and seedHash != ''">
                seed_hash,
            </if>
            <if test="blockValue != null and blockValue != ''">
                block_value,
            </if>
            <if test="luckyAddress != null and luckyAddress != ''">
                lucky_address,
            </if>
            <if test="luckyIndex != null and luckyIndex != ''">
                lucky_index,
            </if>
            begin_time
        </trim>
        )
        values
        (
        <trim suffixOverrides=",">
            <if test="roundNumber != null and roundNumber != ''">
                #{roundNumber},
            </if>
            <if test="goodsName != null and goodsName != ''">
                #{goodsName},
            </if>
            <if test="goodsImg != null and goodsImg != ''">
                #{goodsImg},
            </if>
            <if test="goodsPrice != null and goodsPrice != ''">
                #{goodsPrice},
            </if>
            <if test="seedValue != null and seedValue != ''">
                #{seedValue},
            </if>
            <if test="seedHash != null and seedHash != ''">
                #{seedHash},
            </if>
            <if test="blockValue != null and blockValue != ''">
                #{blockValue},
            </if>
            <if test="luckyAddress != null and luckyAddress != ''">
                #{luckyAddress},
            </if>
            <if test="luckyIndex != null and luckyIndex != ''">
                #{luckyIndex},
            </if>
            NOW()
        </trim>
        )
        <selectKey keyProperty="id" resultType="java.lang.String">
            select LAST_INSERT_ID() as id
        </selectKey>
    </insert>

    <update id="updateRoundInfo">
        update round_info
        <set>
            <if test="roundNumber != null and roundNumber != ''">
                round_number = #{roundNumber},
            </if>
            <if test="goodsName != null and goodsName != ''">
                goods_name = #{goodsName},
            </if>
            <if test="goodsImg != null and goodsImg != ''">
                goods_img = #{goodsImg},
            </if>
            <if test="goodsPrice != null and goodsPrice != ''">
                goods_price = #{goodsPrice},
            </if>
            <if test="seedValue != null and seedValue != ''">
                seed_value = #{seedValue},
            </if>
            <if test="seedHash != null and seedHash != ''">
                seed_hash = #{seedHash},
            </if>
            <if test="blockValue != null and blockValue != ''">
                block_value = #{blockValue},
            </if>
            <if test="luckyAddress != null and luckyAddress != ''">
                lucky_address = #{luckyAddress},
            </if>
            <if test="luckyIndex != null and luckyIndex != ''">
                lucky_index = #{luckyIndex}
            </if>
        </set>
        where id = #{id}
    </update>
</mapper>